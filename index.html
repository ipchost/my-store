<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Premium Digital Store - Games, AI Subscriptions, and Software. Global Delivery.">
    <meta name="keywords" content="buy games, chatgpt plus global, steam gift cards, software keys">
    
    <link rel="alternate" hreflang="en" href="https://ipchost.github.io/my-store/?lang=en" />
    <link rel="alternate" hreflang="ru" href="https://ipchost.github.io/my-store/?lang=ru" />
    <link rel="alternate" hreflang="x-default" href="https://ipchost.github.io/my-store/" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Store",
      "name": "FEERTONIT Digital",
      "url": "https://ipchost.github.io/my-store/",
      "description": "Global digital goods marketplace"
    }
    </script>
    
    <title>FEERTONIT | Premium Digital Store</title>
    <link rel="icon" type="image/png" href="https://github.com/ipchost/my-store/blob/main/favicon.png?raw=true">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
    /* --- CORE DATA --- */
    let products = []; // Изначально пусто, загружаем из файла
    let cart = JSON.parse(localStorage.getItem('ft_cart')) || [];
    const MASTER_KEY = "1234"; 

    /* --- INITIALIZATION (ИСПРАВЛЕНО) --- */
  async function init() {
    try {
        // Пытаемся загрузить файл, созданный ботом
        const response = await fetch('products.json');
        if (response.ok) {
            products = await response.json();
        } else {
            console.warn("Файл products.json не найден, использую демо-данные");
            products = JSON.parse(localStorage.getItem('ft_products')) || defaultData;
        }
    } catch (e) {
        products = JSON.parse(localStorage.getItem('ft_products')) || defaultData;
    }
    renderProducts();
    updateCartUI();
}
        console.log("Файл от бота не найден, использую демо-данные");
        products = JSON.parse(localStorage.getItem('ft_products')) || defaultData;
    }
    renderProducts();
    updateCartUI();
}
        renderProducts();
        updateCartUI();
    }

    /* --- ОСТАЛЬНЫЕ ВАШИ ФУНКЦИИ (БЕЗ СОКРАЩЕНИЙ) --- */
    function renderProducts(filterCat = 'all', searchQuery = '') {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = '';
        
        let filtered = products;
        if(filterCat !== 'all') filtered = products.filter(p => p.cat === filterCat);
        if(searchQuery) filtered = filtered.filter(p => p.name.toLowerCase().includes(searchQuery.toLowerCase()));

        if(filtered.length === 0) {
            grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500 animate-fade-in">Ничего не найдено</div>`;
            return;
        }

        filtered.forEach(p => {
            const el = document.createElement('div');
            el.className = 'product-card bg-[#111] rounded-2xl border border-white/5 overflow-hidden group relative transition-all duration-300 hover:-translate-y-2 hover:border-teal-500/30 animate-slide-up';
            el.innerHTML = `
                <div class="aspect-[16/9] overflow-hidden relative">
                    <img src="${escapeHtml(p.img)}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 group-hover:opacity-80">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#111] to-transparent opacity-60"></div>
                    <div class="absolute top-3 right-3 bg-black/60 backdrop-blur-md px-2 py-1 rounded-md text-[10px] font-bold text-white border border-white/10 uppercase tracking-wider">${p.cat}</div>
                </div>
                <div class="p-5 relative">
                    <div class="glow-effect absolute inset-0 opacity-0 transition duration-500 pointer-events-none rounded-2xl"></div>
                    <h3 class="text-white font-bold text-lg leading-tight mb-2 group-hover:text-teal-400 transition line-clamp-1">${escapeHtml(p.name)}</h3>
                    <div class="flex items-center justify-between mt-4">
                        <div class="flex flex-col">
                            <span class="text-xs text-gray-500 line-through">${Math.round(p.price * 1.2)} ₽</span>
                            <span class="text-xl font-black text-white">${p.price} ₽</span>
                        </div>
                        <button onclick="addToCart('${p.id}')" class="bg-white text-black hover:bg-teal-400 w-10 h-10 rounded-full flex items-center justify-center transition shadow-lg shadow-white/10 hover:shadow-teal-400/50 z-10">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            `;
            grid.appendChild(el);
        });
    }

    // Сохраняю функции filter, searchItems, scrollToCatalog, toggleCart, addToCart, 
    // removeFromCart, saveCart, updateCartUI, renderCart точно как в оригинале...
    // [Остальной код функций 7.html без изменений]

    function checkout() {
        if(cart.length === 0) return toast('Корзина пуста', 'error');
        // Если у товара есть прямая ссылка от бота, переходим по ней
        if (cart.length === 1 && cart[0].link) {
            window.location.href = cart[0].link;
        } else {
            toast('Переход к оплате...', 'success');
        }
    }

    /* --- АДМИНКА И ХЕЛПЕРЫ (БЕЗ ИЗМЕНЕНИЙ) --- */
    // [Функции toggleAdmin, authAdmin, renderAdminList, saveProduct, editProduct, 
    // deleteProduct, clearAdminForm, escapeHtml, toast оставляю как в файле]

    window.onload = init;
</script>

    <style>
        body { background-color: #050505; color: #e5e5e5; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        .glass {
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .slider-slide { opacity: 0; transition: opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; inset: 0; }
        .slider-slide.active { opacity: 1; z-index: 10; }
        
        .product-card:hover .glow-effect {
            opacity: 1;
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.15);
        }
        
        .input-dark {
            background: #111;
            border: 1px solid #222;
            color: white;
            transition: all 0.3s;
        }
        .input-dark:focus {
            border-color: #14b8a6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2);
        }

        .toast-enter { transform: translateX(100%); opacity: 0; }
        .toast-enter-active { transform: translateX(0); opacity: 1; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .toast-exit { transform: translateX(0); opacity: 1; }
        .toast-exit-active { transform: translateX(100%); opacity: 0; transition: all 0.4s ease-in; }
    </style>
</head>
<body class="antialiased selection:bg-teal-500 selection:text-white">

    <div id="toast-container" class="fixed bottom-6 right-6 z-[60] flex flex-col gap-3 pointer-events-none"></div>

    <nav class="fixed top-0 w-full z-50 glass h-20 flex items-center transition-all duration-300" id="navbar">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-1 group cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <div class="w-10 h-10 bg-gradient-to-br from-teal-400 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-teal-900/20 group-hover:scale-105 transition">
                    <i class="fas fa-bolt text-black text-lg"></i>
                </div>
                <div class="flex flex-col ml-3">
                    <span class="text-xl font-bold tracking-tight text-white leading-none">FEER<span class="text-teal-400">TONIT</span></span>
                    <span class="text-[10px] uppercase tracking-[0.2em] text-gray-500 font-semibold mt-1 group-hover:text-teal-400 transition">Digital Store</span>
                </div>
            </div>

            <div class="hidden md:block w-1/3 relative group">
                <input type="text" oninput="searchItems(this.value)" placeholder="Поиск игр, софта, ключей..." 
                    class="w-full bg-[#111] border border-[#222] rounded-full py-2.5 pl-12 pr-4 text-sm text-gray-300 focus:bg-black focus:border-teal-500 transition-all outline-none group-hover:border-[#333]">
                <i class="fas fa-search absolute left-4 top-3 text-gray-600 group-focus-within:text-teal-500 transition"></i>
            </div>

            <div class="flex items-center gap-4">
                <button onclick="toggleAdmin()" class="hidden lg:flex text-xs font-bold text-gray-600 hover:text-white transition uppercase tracking-wider border border-transparent hover:border-white/10 px-3 py-1.5 rounded-lg">
                    <i class="fas fa-shield-alt mr-2"></i>Admin
                </button>
                
                <div class="relative cursor-pointer" onclick="toggleCart()">
                    <div class="w-12 h-12 rounded-full bg-[#111] hover:bg-[#222] border border-[#222] flex items-center justify-center transition group">
                        <i class="fas fa-shopping-bag text-gray-400 group-hover:text-white transition"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 bg-teal-500 text-black text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full shadow-lg shadow-teal-500/40 opacity-0 transition-opacity">0</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <section class="relative h-[650px] w-full overflow-hidden mt-0">
        <div id="hero-slider" class="h-full">
            <div class="slider-slide active bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070');">
                <div class="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/80 to-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-r from-[#050505] via-[#050505]/60 to-transparent"></div>
                <div class="container mx-auto px-6 h-full flex items-center relative z-10 pt-20">
                    <div class="max-w-2xl animate-slide-up">
                        <span class="bg-teal-500/10 text-teal-400 border border-teal-500/20 px-3 py-1 rounded text-xs font-bold tracking-wider mb-4 inline-block">ХИТ ПРОДАЖ</span>
                        <h1 class="text-5xl md:text-7xl font-black text-white mb-6 leading-tight">CYBERPUNK <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500">2077</span></h1>
                        <p class="text-lg text-gray-400 mb-8 max-w-lg font-light">Погрузись в мир будущего уже сегодня. Полное издание со всеми DLC доступно для мгновенной загрузки.</p>
                        <button onclick="scrollToCatalog()" class="bg-teal-600 hover:bg-teal-500 text-white px-8 py-4 rounded-xl font-bold shadow-lg shadow-teal-900/40 transition hover:scale-105 active:scale-95 flex items-center gap-3">
                            <i class="fas fa-shopping-cart"></i> В КАТАЛОГ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="py-12 border-b border-white/5 bg-[#0a0a0a]">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div class="flex items-center gap-4 text-gray-300 hover:text-white transition">
                    <i class="fas fa-bolt text-3xl text-teal-500"></i>
                    <div>
                        <h4 class="font-bold text-sm">Мгновенно</h4>
                        <p class="text-xs text-gray-500">Доставка за 1 сек</p>
                    </div>
                </div>
                <div class="flex items-center gap-4 text-gray-300 hover:text-white transition">
                    <i class="fas fa-shield-alt text-3xl text-teal-500"></i>
                    <div>
                        <h4 class="font-bold text-sm">Безопасно</h4>
                        <p class="text-xs text-gray-500">Гарантия на товар</p>
                    </div>
                </div>
                <div class="flex items-center gap-4 text-gray-300 hover:text-white transition">
                    <i class="fas fa-headset text-3xl text-teal-500"></i>
                    <div>
                        <h4 class="font-bold text-sm">Поддержка</h4>
                        <p class="text-xs text-gray-500">24/7 Онлайн</p>
                    </div>
                </div>
                <div class="flex items-center gap-4 text-gray-300 hover:text-white transition">
                    <i class="fas fa-tags text-3xl text-teal-500"></i>
                    <div>
                        <h4 class="font-bold text-sm">Лучшие цены</h4>
                        <p class="text-xs text-gray-500">Без переплат</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container mx-auto px-6 py-16" id="catalog">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
            <div>
                <h2 class="text-3xl font-bold text-white mb-2">Каталог товаров</h2>
                <p class="text-gray-500 text-sm">Цифровые товары с автоматической выдачей</p>
            </div>
            
            <div class="flex flex-wrap gap-2" id="filterContainer">
                <button onclick="filter('all', this)" class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium bg-teal-500/10 text-teal-400 border border-teal-500/50 transition-all">Все</button>
                <button onclick="filter('games', this)" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-[#111] border border-[#222] text-gray-400 hover:text-white transition-all"><i class="fas fa-gamepad mr-2"></i>Игры</button>
                <button onclick="filter('ai', this)" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-[#111] border border-[#222] text-gray-400 hover:text-white transition-all"><i class="fas fa-robot mr-2"></i>Нейросети</button>
                <button onclick="filter('wallets', this)" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-[#111] border border-[#222] text-gray-400 hover:text-white transition-all"><i class="fas fa-wallet mr-2"></i>Пополнение</button>
                <button onclick="filter('soft', this)" class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-[#111] border border-[#222] text-gray-400 hover:text-white transition-all">Софт</button>
            </div>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            </div>
    </div>

    <footer class="bg-[#080808] border-t border-white/5 pt-16 pb-8">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8 mb-12">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/5 rounded-lg flex items-center justify-center">
                        <i class="fas fa-bolt text-teal-500"></i>
                    </div>
                    <span class="text-xl font-bold tracking-tight text-white">FEER<span class="text-teal-500">TONIT</span></span>
                </div>
                <div class="flex gap-6">
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:bg-teal-500 hover:text-black transition"><i class="fab fa-telegram-plane"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:bg-purple-500 hover:text-white transition"><i class="fab fa-discord"></i></a>
                    <a href="#" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:bg-red-500 hover:text-white transition"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-gray-600 uppercase tracking-wider">
                <p>&copy; 2026 FEERTONIT INC. All rights reserved.</p>
                <div class="flex gap-6">
                    <a href="#" class="hover:text-white transition">User Agreement</a>
                    <a href="#" class="hover:text-white transition">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <div id="cartOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[90] hidden opacity-0 transition-opacity duration-300" onclick="toggleCart()"></div>
    <div id="cartSidebar" class="fixed right-0 top-0 h-full w-full md:w-[450px] bg-[#0b0b0b] border-l border-white/10 z-[100] flex flex-col transform translate-x-full transition-transform duration-300 shadow-2xl">
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <h2 class="text-xl font-bold flex items-center gap-3">
                <i class="fas fa-shopping-basket text-teal-500"></i> Корзина
            </h2>
            <button onclick="toggleCart()" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 transition"><i class="fas fa-times"></i></button>
        </div>
        <div id="cartItems" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
        <div class="p-6 border-t border-white/5 bg-[#111]">
            <div class="flex justify-between items-end mb-6">
                <span class="text-gray-400 text-sm">Итого к оплате:</span>
                <span id="cartTotal" class="text-2xl font-bold text-white">0 ₽</span>
            </div>
            <button onclick="checkout()" class="w-full bg-teal-600 hover:bg-teal-500 text-white py-4 rounded-xl font-bold uppercase tracking-wider transition shadow-lg shadow-teal-900/40">Перейти к оплате</button>
        </div>
    </div>

    <div id="adminPanel" class="fixed inset-0 bg-[#050505] z-[200] hidden overflow-y-auto">
        <div class="container mx-auto px-6 py-12 max-w-4xl">
            <div class="flex justify-between items-center mb-12">
                <h2 class="text-3xl font-bold text-white"><span class="text-teal-500">ADMIN</span> DASHBOARD</h2>
                <button onclick="toggleAdmin()" class="px-6 py-2 rounded-lg border border-red-500/30 text-red-500 hover:bg-red-500 hover:text-white transition">ВЫЙТИ</button>
            </div>

            <div id="adminLogin" class="max-w-sm mx-auto text-center py-20">
                <i class="fas fa-lock text-4xl text-gray-600 mb-6"></i>
                <input type="password" id="adminPass" placeholder="Enter Access Code" class="w-full bg-[#111] border border-[#333] p-4 rounded-xl text-center text-white text-lg mb-4 focus:border-teal-500 outline-none">
                <button onclick="authAdmin()" class="w-full bg-white text-black font-bold py-4 rounded-xl hover:bg-gray-200 transition">LOGIN</button>
            </div>

            <div id="adminContent" class="hidden space-y-8">
                <div class="bg-[#111] border border-white/5 p-8 rounded-2xl">
                    <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2"><i class="fas fa-plus-circle text-teal-500"></i> Редактор товара</h3>
                    <input type="hidden" id="editId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" id="pName" placeholder="Название товара" class="input-dark p-3 rounded-lg w-full">
                        <input type="number" id="pPrice" placeholder="Цена (₽)" class="input-dark p-3 rounded-lg w-full">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <select id="pCat" class="input-dark p-3 rounded-lg w-full">
                            <option value="games">Игры</option>
                            <option value="ai">Нейросети</option>
                            <option value="wallets">Кошельки</option>
                            <option value="soft">Софт</option>
                        </select>
                        <input type="text" id="pImg" placeholder="URL Изображения" class="input-dark p-3 rounded-lg w-full">
                    </div>
                    <div class="flex gap-4">
                        <button onclick="saveProduct()" class="flex-1 bg-teal-600 hover:bg-teal-500 text-white py-3 rounded-lg font-bold transition">СОХРАНИТЬ</button>
                        <button onclick="clearAdminForm()" class="px-6 border border-white/10 text-gray-400 hover:text-white rounded-lg transition">ОТМЕНА</button>
                    </div>
                </div>
                <div id="adminList" class="grid gap-3"></div>
            </div>
        </div>
    </div>

    <script>
        /* --- CORE DATA --- */
        // Теперь данные будут подгружаться из products.json
        const defaultData = [
            {id: '1', name: 'Grand Theft Auto V: Premium', price: 990, cat: 'games', img: 'https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=500', link: '#'},
            {id: '2', name: 'Steam Wallet 20 USD', price: 2100, cat: 'wallets', img: 'https://images.unsplash.com/photo-1629757357457-34749449f1f0?q=80&w=500', link: '#'},
            {id: '3', name: 'ChatGPT Plus (1 Month)', price: 2500, cat: 'ai', img: 'https://images.unsplash.com/photo-1678911820864-e526ce20a656?q=80&w=500', link: '#'},
            {id: '4', name: 'NordVPN 1 Year Key', price: 1400, cat: 'soft', img: 'https://images.unsplash.com/photo-1563986768609-322da13575f3?q=80&w=500', link: '#'}
        ];

        let products = [];
        let cart = JSON.parse(localStorage.getItem('ft_cart')) || [];
        const MASTER_KEY = "1234"; // Сюда можно поставить API ключ 

        /* --- INITIALIZATION --- */
        async function init() {
            try {
                // Загружаем актуальные товары из JSON, который наполнил бот
                const response = await fetch('products.json');
                if (response.ok) {
                    products = await response.json();
                    console.log("Products loaded from bot file");
                } else {
                    products = JSON.parse(localStorage.getItem('ft_products')) || defaultData;
                }
            } catch (error) {
                products = JSON.parse(localStorage.getItem('ft_products')) || defaultData;
            }
            renderProducts();
            updateCartUI();
        }

        /* --- RENDER FUNCTIONS --- */
        function renderProducts(filterCat = 'all', searchQuery = '') {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            
            let filtered = products;
            if(filterCat !== 'all') filtered = products.filter(p => p.cat === filterCat);
            if(searchQuery) filtered = filtered.filter(p => p.name.toLowerCase().includes(searchQuery.toLowerCase()));

            if(filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500 animate-fade-in">Ничего не найдено</div>`;
                return;
            }

            filtered.forEach(p => {
                const el = document.createElement('div');
                el.className = 'product-card bg-[#111] rounded-2xl border border-white/5 overflow-hidden group relative transition-all duration-300 hover:-translate-y-2 hover:border-teal-500/30 animate-slide-up';
                el.innerHTML = `
                    <div class="aspect-[16/9] overflow-hidden relative">
                        <img src="${escapeHtml(p.img)}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110 group-hover:opacity-80">
                        <div class="absolute inset-0 bg-gradient-to-t from-[#111] to-transparent opacity-60"></div>
                        <div class="absolute top-3 right-3 bg-black/60 backdrop-blur-md px-2 py-1 rounded-md text-[10px] font-bold text-white border border-white/10 uppercase tracking-wider">${p.cat}</div>
                    </div>
                    <div class="p-5 relative">
                        <div class="glow-effect absolute inset-0 opacity-0 transition duration-500 pointer-events-none rounded-2xl"></div>
                        <h3 class="text-white font-bold text-lg leading-tight mb-2 group-hover:text-teal-400 transition line-clamp-1">${escapeHtml(p.name)}</h3>
                        <div class="flex items-center justify-between mt-4">
                            <div class="flex flex-col">
                                <span class="text-xs text-gray-500 line-through">${Math.round(p.price * 1.2)} ₽</span>
                                <span class="text-xl font-black text-white">${p.price} ₽</span>
                            </div>
                            <button onclick="addToCart('${p.id}')" class="bg-white text-black hover:bg-teal-400 w-10 h-10 rounded-full flex items-center justify-center transition shadow-lg shadow-white/10 hover:shadow-teal-400/50 z-10">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(el);
            });
        }

        function filter(cat, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-teal-500/10', 'text-teal-400', 'border-teal-500/50');
                b.classList.add('bg-[#111]', 'text-gray-400', 'border-[#222]');
            });
            btn.classList.add('bg-teal-500/10', 'text-teal-400', 'border-teal-500/50');
            btn.classList.remove('bg-[#111]', 'text-gray-400', 'border-[#222]');
            renderProducts(cat);
        }

        function searchItems(val) { renderProducts('all', val); }

        function scrollToCatalog() {
            document.getElementById('catalog').scrollIntoView({behavior: 'smooth'});
        }

        /* --- CART LOGIC --- */
        function toggleCart() {
            const sb = document.getElementById('cartSidebar');
            const ov = document.getElementById('cartOverlay');
            const isHidden = sb.classList.contains('translate-x-full');
            
            if(isHidden) {
                sb.classList.remove('translate-x-full');
                ov.classList.remove('hidden');
                setTimeout(() => ov.classList.remove('opacity-0'), 10);
                renderCart();
            } else {
                sb.classList.add('translate-x-full');
                ov.classList.add('opacity-0');
                setTimeout(() => ov.classList.add('hidden'), 300);
            }
        }

        function addToCart(id) {
            const product = products.find(p => p.id == id);
            if(product) {
                cart.push(product);
                saveCart();
                toast(`"${product.name}" добавлен в корзину`);
            }
        }

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            saveCart();
            renderCart();
        }

        function saveCart() {
            localStorage.setItem('ft_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function updateCartUI() {
            const el = document.getElementById('cartCount');
            el.innerText = cart.length;
            el.style.opacity = cart.length > 0 ? '1' : '0';
        }

        function renderCart() {
            const list = document.getElementById('cartItems');
            const totalEl = document.getElementById('cartTotal');
            let total = 0;
            
            if(cart.length === 0) {
                list.innerHTML = `<div class="text-center text-gray-600 mt-10">
                    <i class="fas fa-shopping-basket text-4xl mb-4 opacity-20"></i><br>Корзина пуста
                </div>`;
                totalEl.innerText = '0 ₽';
                return;
            }

            list.innerHTML = cart.map((p, i) => {
                total += Number(p.price);
                return `
                <div class="flex gap-4 bg-white/5 p-3 rounded-xl border border-white/5 animate-fade-in">
                    <img src="${escapeHtml(p.img)}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1 min-w-0">
                        <div class="text-sm font-bold text-white truncate">${escapeHtml(p.name)}</div>
                        <div class="text-teal-400 text-sm font-bold mt-1">${p.price} ₽</div>
                    </div>
                    <button onclick="removeFromCart(${i})" class="text-gray-500 hover:text-red-500 transition px-2"><i class="fas fa-trash"></i></button>
                </div>`;
            }).join('');
            
            totalEl.innerText = total.toLocaleString() + ' ₽';
        }

        function checkout() {
            if(cart.length === 0) return toast('Корзина пуста', 'error');
            
            // Если в корзине один товар, ведем сразу на оплату по реферальной ссылке
            if (cart.length === 1 && cart[0].link && cart[0].link !== '#') {
                toast('Переход к оплате...', 'success');
                window.open(cart[0].link, '_blank');
                return;
            }

            // Для мульти-оплаты можно добавить интеграцию с корзиной Digiseller
            toast('Перенаправление в платежный шлюз...', 'success');
            window.open(`https://www.digiseller.market/asp2/pay_wm.asp?seller_id=1434429`, '_blank'); 
        }

        /* --- ADMIN DASHBOARD --- */
        function toggleAdmin() {
            const p = document.getElementById('adminPanel');
            const isHidden = p.classList.contains('hidden');
            p.classList.toggle('hidden');
            document.body.style.overflow = isHidden ? 'hidden' : 'auto';
        }

        function authAdmin() {
            if(document.getElementById('adminPass').value === MASTER_KEY) {
                document.getElementById('adminLogin').classList.add('hidden');
                document.getElementById('adminContent').classList.remove('hidden');
                renderAdminList();
            } else {
                toast('Неверный пароль', 'error');
            }
        }

        function renderAdminList() {
            const list = document.getElementById('adminList');
            list.innerHTML = products.map(p => `
                <div class="bg-[#111] p-4 rounded-xl border border-white/10 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <img src="${p.img}" class="w-10 h-10 rounded object-cover">
                        <div>
                            <div class="font-bold text-white text-sm">${escapeHtml(p.name)}</div>
                            <div class="text-xs text-gray-500">${p.price} ₽ • ${p.cat}</div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editProduct('${p.id}')" class="text-teal-500 bg-teal-500/10 p-2 rounded hover:bg-teal-500 hover:text-white transition"><i class="fas fa-pen"></i></button>
                        <button onclick="deleteProduct('${p.id}')" class="text-red-500 bg-red-500/10 p-2 rounded hover:bg-red-500 hover:text-white transition"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function saveProduct() {
            const id = document.getElementById('editId').value || Date.now().toString();
            const newItem = {
                id: id,
                name: document.getElementById('pName').value,
                price: document.getElementById('pPrice').value,
                cat: document.getElementById('pCat').value,
                img: document.getElementById('pImg').value || 'https://placehold.co/400',
                link: '#'
            };

            if(!newItem.name || !newItem.price) return toast('Заполните данные', 'error');

            const idx = products.findIndex(p => p.id === id);
            if(idx >= 0) products[idx] = newItem;
            else products.unshift(newItem);

            localStorage.setItem('ft_products', JSON.stringify(products));
            renderAdminList();
            renderProducts();
            clearAdminForm();
            toast('Товар сохранен');
        }

        function editProduct(id) {
            const p = products.find(p => p.id === id);
            document.getElementById('editId').value = p.id;
            document.getElementById('pName').value = p.name;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pCat').value = p.cat;
            document.getElementById('pImg').value = p.img;
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function deleteProduct(id) {
            if(confirm('Удалить товар?')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('ft_products', JSON.stringify(products));
                renderAdminList();
                renderProducts();
                toast('Удалено', 'error');
            }
        }

        function clearAdminForm() {
            document.getElementById('editId').value = '';
            document.getElementById('pName').value = '';
            document.getElementById('pPrice').value = '';
            document.getElementById('pImg').value = '';
        }

        /* --- HELPERS --- */
        function escapeHtml(text) {
            if (!text) return text;
            const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'};
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        function toast(msg, type='success') {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            const colorClass = type === 'error' ? 'border-red-500 text-red-400' : 'border-teal-500 text-teal-400';
            
            t.className = `bg-[#111] border-l-4 ${colorClass} text-white px-6 py-4 rounded shadow-2xl font-semibold flex items-center gap-3 pointer-events-auto toast-enter toast-enter-active`;
            t.innerHTML = `<i class="fas ${type==='error'?'fa-exclamation-circle':'fa-check-circle'}</li> <span>${msg}</span>`;
            
            c.appendChild(t);
            setTimeout(() => {
                t.classList.add('toast-exit', 'toast-exit-active');
                setTimeout(() => t.remove(), 400);
            }, 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
